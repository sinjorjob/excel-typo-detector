# Excel誤字脱字検出ツール

機械的検出とLLM（ChatGPT）を組み合わせてExcelファイルの誤字・表記ゆれを自動検出し、修正提案を行うツールです。

## 機能

- **機械的検出**: クロスファイル用語統一チェックによる表記ゆれの確実な検出
- **LLM誤字検出**: システム設計書専門の誤字・誤変換・脱字を検出
- **表記ゆれ統一**: プロジェクト内での表記統一ルールに基づく修正提案
- **信頼度評価**: LLMによる修正提案の信頼度スコア（0.7以上のみ出力）
- **レポート生成**: Excel形式での詳細なレビュー台帳を自動生成
- **バッチ処理**: 複数のExcelファイルを一括処理

## 特徴

- **ハイブリッド検出**: 機械的検出（確実性）とLLM検出（文脈理解）の組み合わせ
- **クロスファイル統一**: 複数ファイル・シート間での用語表記統一チェック
- **文脈理解**: システム設計書の文脈を理解した適切な修正提案
- **技術用語保護**: DB・API仕様等の技術用語は英語表記を維持
- **カスタマイズ可能**: 表記統一ルールを設定ファイルで管理

## 必要環境

- Python 3.8+
- OpenAI API キー
- 必要パッケージ（requirements.txtを参照）

## セットアップ

### 1. 仮想環境の作成とアクティベーション

```bash
cd excel-checker
python -m venv venv

# Windows
venv\Scripts\activate

# macOS/Linux
source venv/bin/activate
```

### 2. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 3. 設定ファイルの編集

`config.yml`でLLM設定を行います：

```yaml
llm:
  enabled: true
  provider: "openai"
  model: "gpt-4o"
  min_confidence: 0.70
```

### 4. OpenAI API キーの設定

環境変数または設定ファイルでAPIキーを設定してください。

## 使用方法

### 基本的な使用

```bash
python main.py data/input
```

### ファイル構造

```
excel-checker/
├── src/                    # ソースコード
│   ├── extract.py         # Excelファイル読み込み
│   ├── llm.py            # LLMレビュー機能
│   └── report.py         # レポート生成
├── dict/                   # 辞書ファイル
│   ├── canonicals.yml    # 表記統一ルール
│   └── excludes.yml      # 除外ルール
├── data/
│   ├── input/            # 入力Excelファイル
│   └── output/           # 出力レポート
├── config.yml            # 設定ファイル
└── CLAUDE.md            # 開発指示書
```

## 出力

### レビュー台帳（Excel）

- **サマリーシート**: 検出統計（機械的検出・LLM検出・信頼度別件数）
- **検出結果シート**: 機械的検出とLLM検出の統合結果一覧

### 統計情報

- 総検出数（機械的検出 + LLM検出）
- 機械的検出件数（クロスファイル用語統一）
- LLM検出件数（誤字・表記ゆれ）
- 信頼度別分布
- LLMリクエスト回数

## 設定

### 表記統一ルール (canonicals.yml)

```yaml
rules:
  - expected: "ユーザー"
    patterns: ["ユーザ", "ﾕｰｻﾞ", "user"]
  - expected: "データベース"
    patterns: ["DB", "ﾃﾞｰﾀﾍﾞｰｽ"]
```

### 除外ルール

- 技術仕様（テーブル名・API名等）での英語表記は保護
- 数式セル・数値のみセルは自動除外
- 設定可能な除外パターン

## 開発

### 仮想環境

作業前に必ず仮想環境をアクティベートしてください：

```bash
# アクティベーション
cd venv && Scripts\activate && cd ..

# 非アクティベーション
deactivate
```

### 設計思想

- **ハイブリッドアプローチ**: 機械的検出の確実性とLLMの文脈理解能力を組み合わせ
- **クロスファイル統一**: プロジェクト全体での用語表記の一貫性を確保
- **文脈理解**: システム設計書の専門性を考慮した判定
- **効率性**: バッチ処理による高速化（20セル/リクエスト）

## ライセンス

プライベートプロジェクト

## 履歴

- v1.0: アルゴリズム検出からLLMレビューに完全移行
- v1.1: 機械的検出機能をクロスファイル用語統一チェックに変更
- 半角カタカナ検出に対応（「ﾛｸﾞｲﾝ」と「ログイン」など）
- 文字種別ベースの用語抽出アルゴリズム実装
- 表記ゆれ・誤字の適切な分類機能
- 重複検出除去機能
- サマリーシート統計表示改善